$NetBSD$

The Linux nspluginwrapper-1.4.4 binaries seems built USE_ANONYMOUS_SOCKETS
enabled. In that case we have to handle socket path rename for plugin side
in npw_wrappwer.c and libnoanonsocket.so wrapper library.

--- Makefile.orig	2011-07-01 03:18:57.000000000 +0000
+++ Makefile
@@ -151,6 +151,20 @@ libnoxshm_OBJECTS = $(libnoxshm_RAWSRCS:
 libnoxshm_CFLAGS  = $(CFLAGS_32) $(PIC_CFLAGS)
 libnoxshm_LDFLAGS = $(LDFLAGS_32)
 
+ifeq (,$(findstring $(OS),linux))
+libnoanonsocket_LIBRARY = libnoanonsocket.so
+libnoanonsocket_RAWSRCS = libnoanonsocket.c
+libnoanonsocket_SOURCES = $(libnoanonsocket_RAWSRCS:%.c=$(SRC_PATH)/src/%.c)
+libnoanonsocket_OBJECTS = $(libnoanonsocket_RAWSRCS:%.c=libnoanonsocket-%.o)
+ifeq ($(ARCH),x86_64)
+libnoanonsocket_CFLAGS  = -m32 $(CFLAGS_32) $(PIC_CFLAGS)
+libnoanonsocket_LDFLAGS = -m elf_i386 $(LDFLAGS_32)
+else
+libnoanonsocket_CFLAGS  = $(CFLAGS_32) $(PIC_CFLAGS)
+libnoanonsocket_LDFLAGS = $(LDFLAGS_32)
+endif
+endif
+
 npconfig_PROGRAM = npconfig
 npconfig_RAWSRCS = npw-config.c
 npconfig_SOURCES = $(npconfig_RAWSRCS:%.c=$(SRC_PATH)/src/%.c)
@@ -193,6 +207,9 @@ CPPFLAGS	= -I. -I$(SRC_PATH)
 TARGETS		= $(npconfig_PROGRAM)
 TARGETS		+= $(nploader_PROGRAM)
 TARGETS		+= $(npwrapper_LIBRARY)
+ifeq (,$(findstring $(OS),linux))
+TARGETS		+= $(libnoanonsocket_LIBRARY)
+endif
 ifeq ($(build_viewer),yes)
 TARGETS		+= $(npviewer_PROGRAM)
 TARGETS		+= $(libnoxshm_LIBRARY)
@@ -323,6 +340,14 @@ $(libnoxshm_LIBRARY): $(libnoxshm_OBJECT
 libnoxshm-%.o: $(SRC_PATH)/src/%.c
 	$(CC) -o $@ -c $< $(CPPFLAGS) $(libnoxshm_CFLAGS)
 
+ifeq (,$(findstring $(OS),linux))
+$(libnoanonsocket_LIBRARY): $(libnoanonsocket_OBJECTS) $(LSB_OBJ_DIR) $(LSB_LIBS)
+	$(LD) $(DSO_LDFLAGS) $(libnoanonsocket_LDFLAGS) -o $@ $(libnoanonsocket_OBJECTS)
+
+libnoanonsocket-%.o: $(SRC_PATH)/src/%.c
+	$(CC) -o $@ -c $< $(CPPFLAGS) $(libnoanonsocket_CFLAGS)
+endif
+
 $(npconfig_PROGRAM): $(npconfig_OBJECTS)
 	$(CC) $(npconfig_LDFLAGS) -o $@ $(npconfig_OBJECTS) $(npconfig_LIBS)
 
